# –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ "–ë–æ–ª—Ç–∞–π –∏ –ó–Ω–∞–∫–æ–º—å—Å—è"

## üìä –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤–∫–ª—é—á–∞–µ—Ç:
- **Prometheus** - —Å–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **Alertmanager** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∞–ª–µ—Ä—Ç—ã
- **Node Exporter** - –º–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- **PostgreSQL Exporter** - –º–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Redis Exporter** - –º–µ—Ç—Ä–∏–∫–∏ Redis

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
cd backend
docker-compose -f docker-compose.monitoring.yml up -d
```

### 2. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º
- **Grafana**: http://localhost:3000 (admin/admin123)
- **Prometheus**: http://localhost:9090
- **Alertmanager**: http://localhost:9093

### 3. –ò–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Dashboards ‚Üí Import
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `grafana/dashboards/app-metrics.json`

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### HTTP –º–µ—Ç—Ä–∏–∫–∏
- `http_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `auth_attempts_total` - –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `user_registrations_total` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `active_users_total` - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### –ó–≤–æ–Ω–∫–∏
- `calls_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–æ–Ω–∫–æ–≤
- `call_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤–æ–Ω–∫–æ–≤
- `active_calls_total` - –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–≤–æ–Ω–∫–∏

### WebSocket
- `websocket_connections_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `websocket_connections_active` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `user_reports_total` - –∂–∞–ª–æ–±—ã –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `memory_usage_bytes` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- `cpu_usage_percent` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
- `errors_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

## üîî –ê–ª–µ—Ä—Ç—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã
- **ServiceDown** - —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **HighErrorRate** - –≤—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫
- **HighHTTP5xxRate** - –≤—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **HighHTTPResponseTime** - –≤—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- **HighMemoryUsage** - –≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **HighCPUUsage** - –≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
- **HighWebSocketConnections** - –º–Ω–æ–≥–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **HighActiveCalls** - –º–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
- **HighAuthFailureRate** - –º–Ω–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- **HighUserReportsRate** - –º–Ω–æ–≥–æ –∂–∞–ª–æ–±

## üìä –î–∞—à–±–æ—Ä–¥—ã Grafana

### –û—Å–Ω–æ–≤–Ω–æ–π –¥–∞—à–±–æ—Ä–¥
–í–∫–ª—é—á–∞–µ—Ç 12 –ø–∞–Ω–µ–ª–µ–π:
1. **HTTP –ó–∞–ø—Ä–æ—Å—ã** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º
2. **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ HTTP** - 95-–π –∏ 50-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏
3. **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
4. **–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–≤–æ–Ω–∫–∏** - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
5. **WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
6. **–ü–æ–ø—ã—Ç–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** - —É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É–¥–∞—á–Ω—ã–µ
7. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
8. **–ñ–∞–ª–æ–±—ã –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –ø–æ –ø—Ä–∏—á–∏–Ω–∞–º
9. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** - heap –∏ process
10. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU** - –ø—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
11. **–û—à–∏–±–∫–∏** - –ø–æ —Ç–∏–ø–∞–º –∏ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
12. **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤–æ–Ω–∫–æ–≤** - –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Prometheus
- –§–∞–π–ª: `prometheus/prometheus.yml`
- –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞: 15 —Å–µ–∫—É–Ω–¥
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: 200 —á–∞—Å–æ–≤

### Alertmanager
- –§–∞–π–ª: `alertmanager/alertmanager.yml`
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: webhook, email, Slack
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤: –ø–æ –∏–º–µ–Ω–∏

### Grafana
- –ü–æ—Ä—Ç: 3000
- –õ–æ–≥–∏–Ω: admin/admin123
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `alertmanager/alertmanager.yml`
2. –£–∫–∞–∂–∏—Ç–µ SMTP —Å–µ—Ä–≤–µ—Ä –∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Alertmanager

### Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
1. –°–æ–∑–¥–∞–π—Ç–µ webhook –≤ Slack
2. –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Alertmanager

### Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
1. –°–æ–∑–¥–∞–π—Ç–µ endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
2. –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Alertmanager

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
```javascript
const newMetric = new promClient.Counter({
  name: 'new_metric_total',
  help: '–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏',
  labelNames: ['label1', 'label2']
});
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫–∏
```javascript
register.registerMetric(newMetric);
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ
```javascript
newMetric.labels('value1', 'value2').inc();
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –¥–∞—à–±–æ—Ä–¥
1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –ø–∞–Ω–µ–ª—å
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PromQL –∑–∞–ø—Ä–æ—Å

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
```bash
curl http://localhost:3001/metrics
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus
```bash
curl http://localhost:9090/api/v1/targets
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
```bash
curl http://localhost:9090/api/v1/alerts
```

### –õ–æ–≥–∏ Prometheus
```bash
docker logs boltaiznakomsya-prometheus
```

### –õ–æ–≥–∏ Grafana
```bash
docker logs boltaiznakomsya-grafana
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ PromQL –∑–∞–ø—Ä–æ—Å—ã

### –¢–æ–ø-5 —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
```promql
topk(5, histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])))
```

### –ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º
```promql
rate(errors_total[5m])
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
```promql
(memory_usage_bytes{type="heap"} / memory_usage_bytes{type="process"}) * 100
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
```promql
increase(active_users_total[1h])
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ Grafana
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Grafana
GF_SECURITY_ADMIN_PASSWORD=secure_password

# Prometheus
PROMETHEUS_CONFIG_FILE=/etc/prometheus/prometheus.yml

# Alertmanager
ALERTMANAGER_CONFIG_FILE=/etc/alertmanager/alertmanager.yml
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Prometheus
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ federation –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Thanos –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ retention policy
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã PromQL

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å `/metrics`
2. **–ê–ª–µ—Ä—Ç—ã –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∞–≤–∏–ª
3. **Grafana –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ datasource
4. **–í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ retention policy

### –ö–æ–Ω—Ç–∞–∫—Ç—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [README.md](../README.md)
- Issues: [GitHub Issues](https://github.com/your-repo/issues)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: support@boltaiznakomsya.com 